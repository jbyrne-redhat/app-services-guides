////
START GENERATED ATTRIBUTES
WARNING: This content is generated by running npm --prefix .build run generate:attributes
////

//All OpenShift Application Services
:org-name: Application Services
:product-long-rhoas: OpenShift Application Services
:community:
:imagesdir: ./images
:property-file-name: app-services.properties
:samples-git-repo: https://github.com/redhat-developer/app-services-guides
:base-url: https://github.com/redhat-developer/app-services-guides/tree/main/docs/
:sso-token-url: https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token
:cloud-console-url: https://console.redhat.com/
:service-accounts-url: https://console.redhat.com/application-services/service-accounts

//OpenShift Application Services CLI
:base-url-cli: https://github.com/redhat-developer/app-services-cli/tree/main/docs/
:command-ref-url-cli: commands
:installation-guide-url-cli: rhoas/rhoas-cli-installation/README.adoc
:service-contexts-url-cli: rhoas/rhoas-service-contexts/README.adoc

//OpenShift Streams for Apache Kafka
:product-long-kafka: OpenShift Streams for Apache Kafka
:product-kafka: Streams for Apache Kafka
:product-version-kafka: 1
:service-url-kafka: https://console.redhat.com/application-services/streams/
:getting-started-url-kafka: kafka/getting-started-kafka/README.adoc
:kafka-bin-scripts-url-kafka: kafka/kafka-bin-scripts-kafka/README.adoc
:kafkacat-url-kafka: kafka/kcat-kafka/README.adoc
:quarkus-url-kafka: kafka/quarkus-kafka/README.adoc
:nodejs-url-kafka: kafka/nodejs-kafka/README.adoc
:getting-started-rhoas-cli-url-kafka: kafka/rhoas-cli-getting-started-kafka/README.adoc
:topic-config-url-kafka: kafka/topic-configuration-kafka/README.adoc
:consumer-config-url-kafka: kafka/consumer-configuration-kafka/README.adoc
:access-mgmt-url-kafka: kafka/access-mgmt-kafka/README.adoc
:metrics-monitoring-url-kafka: kafka/metrics-monitoring-kafka/README.adoc
:service-binding-url-kafka: kafka/service-binding-kafka/README.adoc
:message-browsing-url-kafka: kafka/message-browsing-kafka/README.adoc

//OpenShift Service Registry
:product-long-registry: OpenShift Service Registry
:product-registry: Service Registry
:registry: Service Registry
:product-version-registry: 1
:service-url-registry: https://console.redhat.com/application-services/service-registry/
:getting-started-url-registry: registry/getting-started-registry/README.adoc
:quarkus-url-registry: registry/quarkus-registry/README.adoc
:getting-started-rhoas-cli-url-registry: registry/rhoas-cli-getting-started-registry/README.adoc
:access-mgmt-url-registry: registry/access-mgmt-registry/README.adoc
:content-rules-registry: https://access.redhat.com/documentation/en-us/red_hat_openshift_service_registry/1/guide/9b0fdf14-f0d6-4d7f-8637-3ac9e2069817[Supported Service Registry content and rules]
:service-binding-url-registry: registry/service-binding-registry/README.adoc

//OpenShift Connectors
:connectors: Connectors
:product-long-connectors: OpenShift Connectors
:product-connectors: Connectors
:product-version-connectors: 1
:service-url-connectors: https://console.redhat.com/application-services/connectors
:getting-started-url-connectors: connectors/getting-started-connectors/README.adoc
:getting-started-rhoas-cli-url-connectors: connectors/rhoas-cli-getting-started-connectors/README.adoc

//OpenShift API Designer
:product-long-api-designer: OpenShift API Designer
:product-api-designer: API Designer
:product-version-api-designer: 1
:service-url-api-designer: https://console.redhat.com/application-services/api-designer/
:getting-started-url-api-designer: api-designer/getting-started-api-designer/README.adoc

//OpenShift API Management
:product-long-api-management: OpenShift API Management
:product-api-management: API Management
:product-version-api-management: 1
:service-url-api-management: https://console.redhat.com/application-services/api-management/

////
END GENERATED ATTRIBUTES
////


[id="chap-intreacting-with-rhoas-using-apis"]
= Interacting with {product-long-rhoas} using APIs
:context: installing-rhoas-cli

[role="_abstract"]
As a developer or administrator you can use a web console and command-line interface (CLI)  to interact with your service instances in {product-long-rhoas}. There are also a number of REST APIs that you can use to interact with your instances. This guide provides an overview of the APIs.

NOTE: Before adopting a REST API, check whether the client you need is not already available. A number of open source SDKs for major programming languages are available in the https://github.com/topics/rhoas-sdk[rhoas-sdk^] GitHub repository.

[id="con-api-types"]
== API types

[role="_abstract"]
{product-long-rhoas} provides two sets of REST APIs; a set of _management_ APIs and a set of _instance_ APIs. These API types are described below.

ifndef::community[]
The APIs are available to any user that has a Red Hat account and access to running {product-long-rhoas} instances.
endif::[]

Management APIs::
Use a set of management APIs (for example, the _{product-kafka} Management API_, _{product-registry} Management API_, and _{product-connectors} Management API_) to perform management tasks for {product-long-rhoas}. These tasks include the following:
+
--
* Retrieving instance information
* Creating, deleting, or updating service deployments
* Managing security
* Viewing metrics
--
+
All of the management APIs have the same base URL of https://api.openshift.com. This is the base URL for each endpoint in the API.

Instance APIs::
Use a set of instance APIs (for example, the _{product-kafka} Instance API_ and _{product-registry} Instance API_) to interact with specific service instances in {product-long-rhoas}. The APIs enable you to manage and interact with resources and artifacts in your service instances.
+
The base URL for an instance API is automatically generated when you create a service instance in {product-long-rhoas}. This is the base URL for each endpoint in the API.  You can get the base URL for an instance API in the following ways:
+
* Using the management API for the service
* Using the web console for the service

[role="_additional-resources"]
.Additional resources
* To learn more about getting the base URL for instance APIs, see

[id="con-accessing-rhoas-apis"]
== Accessing the {product-long-rhoas} APIs

[role="_abstract"]
To access the {product-long-rhoas} APIs, open the API documentation portal at https://console.redhat.com/docs/api and expand the *Application Services* section.

Each API has a Swagger web interface that you can use instead of a standalone REST client or curl utility to interact with your instances in {product-long-rhoas}. You can use the Swagger interface for operations such as the following:

* Performing authentication for the APIs
* Viewing API versions, descriptions, and metadata
* Viewing all available endpoints, including required input and expected output.
* Sending API requests
* Getting the corresponding curl commands for API requests

[role="_additional-resources"]
.Additional resources
* To learn more, see

[id="con-getting-base-url-for-instance-api"]
== Getting the base URL for an instance API

[role="_abstract"]
The base URL for an instance API is automatically generated when you create a service instance in {product-long-rhoas}. This is the base URL for each endpoint in the API.  You can get the base URL for an instance API in the following ways:

* Using the management API for the service
* Using the web console for the service

These methods are described in the following subsections.

[id="proc-getting-base-url-using-management-api_{context}"]
=== Getting the base URL using the management API

[role="_abstract"]
The management API for each service has an endpoint that lists all of your service instances. When you send a request to that endpoint, the API response includes the base URL for the API of each instance.

For example, in the {product-long-kafka} Management API, you can use *default → [GET] /api/kafkas_mgmt/v1/kafkas* to retrieve a list of Kafka instances. For each instance, the API response includes a field called `admin_api_server_url`. The value of that field is the base URL for the API of that Kafka instance.

[id="proc-getting-base-url-using-web-console_{context}"]
=== Getting the base URL using the web console

[role="_abstract"]
You can use the web console for {product-long-kafka} or {product-long-registry} to get the base URL for an instance API.

[discrete,id="getting-base-url-for-openshift-streams_{context}"]
==== {product-kafka}

.Prerequisites
* You have a Kafka instance in {product-kafka}.

.Procedure

. Open the {service-url-kafka}[Kafka Instances^] page of the {product-kafka} web console.
. For your Kafka instance, select the options icon (three vertical dots), and click *Connection*.
+
A side pane opens that shows connection information for your instance.
. In the side pane, expand  the *REST APIs* section.
+
The *REST APIs* section shows the URLs for the instance and management APIs, as shown below.
+
--
[.screencapture]
.Getting the base URL for the API of a Kafka instance
image::kafka-api-details.png[Image of REST API details for Kafka instance]
--
. Copy the *URL for Kafka instance API* value.

[discrete,id="getting-base-url-for-openshift-service-registry_{context}"]
==== {product-registry}

.Prerequisites
* You have a {product-registry} instance.

.Procedure

. Open the {service-url-registry}[Service Registry Instances^] page of the {product-registry} web console.
. For your {registry} instance, select the options menu (three vertical dots), and click *Connection*.
+
A side pane opens that shows connection information for your instance, as shown below.
+
--
[.screencapture]
.Getting the base URL for the API of a {registry} instance
image::registry-api-details.png[Image of REST API details for {registry} instance]
--
. Copy the *Core Registry API* value.

[id="con-authenticating-rhoas-apis"]
== Authenticating the {product-long-rhoas} APIs

[role="_abstract"]
Authentication for OpenShift Application Services is handled by the https://sso.redhat.com[Red Hat Single Sign-On^] (SSO) service. To use the APIs, you must authenticate them to the Red Hat SSO service using either an access token or an access token URL.

The following subsections describe how to authenticate the APIs.

[id="proc-getting-access-token"]
=== Getting an access token

[role="_abstract"]
You can get an access token for OAuth 2.0 token-based authentication using one of the following methods:

* Exchanging an offline refresh token for an access token
* Using an SSO client to request an access token
* Generating an access token using service account details (applicable to instance APIs only)

The following subsections describe how to use each of these methods to get an access token.

[discrete,id="exchanging-offline-refresh-token-for-access-token_{context}"]
==== Exchanging an offline refresh token for an access token

An offline refresh token enables you to perform API requests acting as a logged-in user,
without the need to periodically log in to an SSO service. {product-long-rhoas} provides offline refresh tokens. Then, when you need to authenticate a {product-long-rhoas} API, you can make a request to the Red Hat SSO service to exchange this offline refresh token for a live access token.

The following procedure describes how to exchange an offline refresh token for an access token. The access token supplied by this method is short-lived (typically 5 minutes).

.Procedure

. To get an offline refresh token for {product-long-rhoas}, open https://cloud.redhat.com/openshift/token in your web browser.
. On the *OpenShift Cluster Manager API Token* page, click *Load token*.
+
The browser refreshes the page.

. Under *Your API Token*, copy the token shown.
. To exchange the offline refresh token for a live access token, make an API request to the Red Hat SSO service. An example using curl is shown below.
+
[source,subs="+attributes,+quotes"]
----
curl --location --request POST
'{sso-token-url}' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'refresh_token=<your-offline-refresh-token> \
--data-urlencode 'scope=email' \
--data-urlencode 'grant_type=refresh_token'
--data-urlencode 'client_id=cloud-services'
----

In the command shown above, replace _<your-offline-refresh-token>_ with the offline refresh token that you copied.

[discrete,id="using-sso-client-to-request-access-token_{context}"]
==== Using an SSO client to request an access token

You can use an open source SSO client such as https://www.npmjs.com/package/keycloak-js[Keycloak JS^] to request an access token from the Red Hat SSO service. The token returned by this method enables you to execute API requests as a logged-in user. The access token supplied by this method is short-lived (typically 5 minutes).

To properly format a request to the Red Hat SSO service, consult the documentation for your client. However, any request to the Red Hat SSO service must include the following details:

[source]
----
Token URL: https://sso.redhat.com/auth/realms/redhat-external
Client Name: rhoas-cli-prod
Valid Redirect URLS: http://localhost*
----

[discrete,id="generating-access-token-using-service-account_{context}"]
==== Generating an access token using service account details

You can use a service account to execute API requests in an instance API. A service account acts as a different principal to the original user that created it. You can use the service account details to request an authentication token from the Red Hat SSO service. The access token supplied by this method is short-lived (typically 5 minutes).

.Prerequisites
* You have a service account in {product-long-rhoas}. To learn how to use the `rhoas` command-line interface to create a service account, see https://access.redhat.com/documentation/en-us/red_hat_openshift_streams_for_apache_kafka/1/guide/88e1487a-2a14-4b35-85b9-a7a2d67a37f3[Getting started with the rhoas CLI^].

.Procedure
* Include  your service account credentials in a request to the Red Hat SSO service, as shown below.
+
[source,subs="+attributes,+quotes"]
----
curl --location --request POST '{sso-token-url}' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'client_id=_<client-id>_' \
--data-urlencode 'client_secret=_<client-secret>_' \
--data-urlencode 'scope=email' \
--data-urlencode 'grant_type=client_credentials'
----
+
In the command shown above, replace _<client-id>_ and _<client-secret>_ with the credentials for your service account.

[id="proc-getting-access-token-refresh-url"]
=== Getting an access token refresh URL

[role="_abstract"]
In some situations, you can use an access token refresh URL in place of a token value itself. To get an access token refresh URL, perform one of the following actions:

* When you create a service account using the `rhoas` command-line interface (CLI), save the value of `oauthTokenUrl` to a secure location for later use.

* In the web console for the service, select the options icon (three vertical dots) for a service instance and click *Connection*. Copy the value of *Token endpoint URL* to a secure location for later use.

[id="proc-configuring-access-to-rhoas-instances"]
=== Configuring access to your {product-long-rhoas} instances

[role="_abstract"]
If you used a service account to generate an access token, you must also grant this service account access to your service instances. This is also true if you want to allow other user accounts to execute API requests against service instances that you own.

To learn how to manage the level of  access that service accounts and other user accounts have to your service instances, see the following guides:

* https://access.redhat.com/documentation/en-us/red_hat_openshift_streams_for_apache_kafka/1/guide/2f4bf7cf-5de2-4254-8274-6bf71673f407[Managing account access in Red Hat OpenShift Streams for Apache Kafka^]
* https://access.redhat.com/documentation/en-us/red_hat_openshift_service_registry/1/guide/7717db0b-9fad-4fff-91b7-b311b63290a4[Managing account access in Red Hat OpenShift Service Registry^]

[id="proc-performing-api-authentication-in-command-line-client"]
=== Performing API authentication in a command-line client

[role="_abstract"]
To authenticate an API from a standalone REST client or curl utility, you must include an authorization header in your API requests.

.Prerequisites
* You have an access token.

.Procedure

* In your API request, include `Authorization: Bearer _<access-token>_` as a header. Replace _<access-token>_ with your own access token value.
+
A curl example is shown below.
+
[source,subs="+quotes"]
----
curl -X 'GET' \
  'https://api.openshift.com/api/kafkas_mgmt/v1/kafkas?page=1&size=100&orderBy=name%20asc&search=name%20%3D%20my-kafka%20and%20cloud_provider%20%3D%20aws' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer _<access-token>_
----

[id="proc-performing-api-authentication-in-swagger"]
=== Performing API authentication in the Swagger web interface

NOTE: The following section applies to only the {product-long-rhoas} _management_ APIs. Although the instance APIs also have OpenAPI specs and are visible in the API portal, you cannot use the Swagger interface to perform authentication or send API requests.

[role="_abstract"]
The {product-long-rhoas} management APIs have Swagger web interfaces that you can use to interact with your service instances. When you execute a request in the Swagger web interface (optionally adding request parameters), the web interface shows the full curl command that corresponds to the request. Therefore, the web interface can be a very useful way to learn how to use the API and properly format requests for a command-line client.

Before you can use the Swagger web interface to execute API requests, you must complete authentication for the API.

.Prerequisites
* You have an access token or access token refresh URL.

.Procedure
. In a web browser, open the Swagger page for the API you want to use. For example, the https://console.redhat.com/docs/api/kafkamgmt?github-owner=redhat-developer&github-repo=app-services-sdk-core&github-content=kas-fleet-manager.yaml%3Fref%3Ddoc-portal[OpenShift Streams for Apache Management API^].
. In the upper-right corner, click *Authorize*. Or, select the lock icon for a specific endpoint.
+
An authorization dialog box opens.
. Enter an access token (Bearer) or  an access token URL (http).
. Click *Authorize*.
+
The authorization dialog box shows *Authorized*.


[id="proc-performing-api-authentication-in-swagger"]
== Sending API requests in the Swagger web interface

NOTE: The following section applies to only the {product-long-rhoas} _management_ APIs. Although the instance APIs also have OpenAPI specs and are visible in the API portal, you cannot use the Swagger interface to perform authentication or send API requests.

[role="_abstract"]
The {product-long-rhoas} management APIs have Swagger web interfaces that you can use to interact with your service instances. When you execute a request in the Swagger web interface (optionally adding request parameters), the web interface shows the full curl command that corresponds to the request. Therefore, the web interface can be a very useful way to learn how to use the API and properly format requests for a command-line client.

The following example  shows how to use the Swagger interface to send some API requests.

.Prerequisites
* You have completed authentication for the relevant API.
* You have configured access to your service instances.

.Procedure
. In your web browser,  open the API documentation portal at https://console.redhat.com/docs/api[https://console.redhat.com/docs/api^] and expand the *Application Services* section.
. For this example, open the {product-kafka} Management API.
. In the {product-kafka} Management API, navigate to *default → [GET] /api/kafkas_mgmt/v1/kafkas*. This endpoint enables you to retrieve a list of Kafka instances.
. Click *Try it out*.
. (Optional) follow the instructions in the interface to provide additional parameters that filter the results.
. Click *Execute* and review the response from the API.
+
For *[GET] /api/kafkas_mgmt/v1/kafkas*, the API lists all the Kafka instances that you are authorized to see.
. Copy or note the ID of a listed Kafka instance.
. Navigate to *default → [GET] /api/kafkas_mgmt/v1/kafkas/{id}*.
. Click *Try it out*.
. For the *id* parameter, enter the Kafka instance ID that you previously copied.
. Click *Execute* and review the response from the API.
+
For *[GET] /api/kafkas_mgmt/v1/kafkas/{id}*, the API shows detailed information for the specified Kafka instance.

ifdef::parent-context[:context: {parent-context}]
ifndef::parent-context[:!context:]
